<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI趣学英语</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4facfe;
            --secondary-color: #00f2fe;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #ff4757;
            --dark-color: #333;
            --light-bg: #f5f7fa;
            --card-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        body { font-family: 'PingFang SC', sans-serif; background: var(--light-bg); margin: 0; padding-bottom: 80px; }
        header { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .container { max-width: 800px; margin: 0 auto; padding: 15px; }

        /* 内容板块控制 */
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* 分级导航 */
        .level-nav { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 15px; margin-bottom: 10px; }
        .level-item { 
            flex: 0 0 auto; padding: 8px 20px; border-radius: 20px; background: white; 
            border: 1px solid #ddd; cursor: pointer; font-weight: bold; transition: 0.3s;
        }
        .level-item.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }

        .card { background: white; border-radius: 15px; margin-bottom: 20px; overflow: hidden; box-shadow: var(--card-shadow); }
        .card-header { background: #f8f9fa; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; font-weight: bold; }
        .card-body { padding: 20px; }

        /* 播放器与字幕 */
        .video-container { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 10px; margin-bottom: 15px; overflow: hidden; }
        video { width: 100%; height: 100%; }
        .transcript-container { max-height: 250px; overflow-y: auto; margin-bottom: 15px; }
        .transcript-line { padding: 12px; border-radius: 8px; cursor: pointer; transition: 0.2s; border-left: 4px solid transparent; margin-bottom: 5px; background: #f9f9f9; }
        .transcript-line.active { background: #e3f2fd; border-left-color: var(--primary-color); font-weight: bold; }
        .translation { display: block; color: #666; font-size: 0.85rem; margin-top: 5px; }

        .player-controls { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
        .control-btn { border: none; padding: 10px 18px; border-radius: 50px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: 500; transition: 0.3s; background: #eee; }
        .control-btn.success { background: var(--success-color); color: white; }
        .control-btn.primary { background: var(--primary-color); color: white; }

        /* 列表展示 */
        .course-item { display: flex; gap: 15px; align-items: center; padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; transition: 0.2s; }
        .course-item:hover { background: #f0f7ff; }
        .course-icon { font-size: 1.8rem; color: var(--primary-color); width: 50px; text-align: center; }
        .course-difficulty { font-size: 0.75rem; background: #e3f2fd; color: #1976d2; padding: 2px 8px; border-radius: 10px; }

        /* 笔记样式 */
        .note-card { background: #fffde7; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 5px solid #ffd600; }
        .note-del-btn { color: var(--danger-color); border: none; background: none; cursor: pointer; }

        /* 底部导航 */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; border-top: 1px solid #eee; padding: 12px 0; z-index: 1000; }
        .nav-item { flex: 1; text-align: center; color: #888; cursor: pointer; font-size: 0.8rem; }
        .nav-item.active { color: var(--primary-color); }
        .nav-item i { font-size: 1.3rem; display: block; margin-bottom: 3px; }

        /* 评分弹窗 */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; z-index: 2000; }
        .ai-score-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; width: 85%; max-width: 400px; padding: 30px; border-radius: 20px; text-align: center; display: none; z-index: 2001; }
        .active { display: block !important; }
    </style>
</head>
<body>

    <header><h1>AI趣学英语 iLearning</h1></header>

    <main class="container">
        <section id="original" class="content-section active">
            <div id="course-home">
                <div class="level-nav" id="level-filter">
                    <div class="level-item active" data-level="all">全部</div>
                    <div class="level-item" data-level="L1">L1</div><div class="level-item" data-level="L2">L2</div>
                    <div class="level-item" data-level="L3">L3</div><div class="level-item" data-level="L4">L4</div>
                    <div class="level-item" data-level="L5">L5</div><div class="level-item" data-level="L6">L6</div>
                    <div class="level-item" data-level="L7">L7</div><div class="level-item" data-level="L8">L8</div>
                    <div class="level-item" data-level="L9">L9</div>
                </div>
                <div class="card">
                    <div id="course-list">
                        </div>
                </div>
            </div>

            <div id="player-section" style="display:none;">
                <div class="card">
                    <div class="card-header">
                        <span onclick="closePlayer()" style="cursor:pointer"><i class="fas fa-chevron-left"></i> <span id="player-title">正在加载</span></span>
                        <span style="font-size:0.8rem;">译文 <input type="checkbox" id="trans-toggle" checked onclick="toggleTrans()"></span>
                    </div>
                    <div class="card-body">
                        <div class="video-container">
                            <video id="main-video" controls poster="https://via.placeholder.com/800x450?text=Video+Loading..."><source src="" type="video/mp4"></video>
                        </div>
                        <div class="transcript-container" id="transcript-box">
                            </div>
                        <div class="player-controls">
                            <button class="control-btn" onclick="repeatLine()"><i class="fas fa-redo"></i> 复读</button>
                            <button class="control-btn success" onclick="startRecording()"><i class="fas fa-microphone"></i> 跟读配音</button>
                            <select id="speed-sel" onchange="changeSpeed()" style="border-radius:20px; padding:5px; border:1px solid #ddd;">
                                <option value="0.8">0.8x</option><option value="1.0" selected>1.0x</option><option value="1.5">1.5x</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="vocabulary" class="content-section">
            <div class="card">
                <div class="card-body">
                    <div class="search-bar" style="background:#f0f2f5; padding:10px; border-radius:20px; display:flex; align-items:center; margin-bottom:15px;">
                        <i class="fas fa-search" style="margin-left:10px; color:#999"></i>
                        <input type="text" id="word-search" placeholder="搜索生词..." oninput="filterWords()" style="border:none; background:none; outline:none; margin-left:10px; width:100%">
                    </div>
                    <div id="word-list-box"></div>
                </div>
            </div>
        </section>

        <section id="favorites" class="content-section">
            <div class="card">
                <div class="card-header">我的收藏</div>
                <div class="card-body" id="fav-list-box"></div>
            </div>
        </section>

        <section id="notes" class="content-section">
            <div class="card">
                <div class="card-header">学习笔记 <button class="control-btn primary" onclick="addNote()" style="padding:4px 12px; font-size:0.8rem">添加</button></div>
                <div class="card-body" id="notes-list-box"></div>
            </div>
        </section>
    </main>

    <nav class="bottom-nav">
        <div class="nav-item active" data-tab="original"><i class="fas fa-book-open"></i>原本</div>
        <div class="nav-item" data-tab="vocabulary"><i class="fas fa-spell-check"></i>词汇</div>
        <div class="nav-item" data-tab="favorites"><i class="fas fa-heart"></i>收藏</div>
        <div class="nav-item" data-tab="notes"><i class="fas fa-sticky-note"></i>笔记</div>
    </nav>

    <div class="overlay" id="overlay"></div>
    <div class="ai-score-modal" id="score-modal">
        <div style="font-size:1.2rem; font-weight:bold; margin-bottom:10px;">AI 发音评分</div>
        <div style="width:80px; height:80px; border:6px solid var(--success-color); border-radius:50%; line-height:80px; font-size:1.8rem; margin:0 auto 15px; color:var(--success-color); font-weight:bold;" id="score-val">--</div>
        <div id="score-text" style="color:#666; font-size:0.9rem; margin-bottom:20px;">正在分析发音细节...</div>
        <button class="control-btn primary" style="width:100%" onclick="closeScore()">确认</button>
    </div>

    <script>
        // --- 核心数据库：视频、等级、对应字幕 ---
        const videoDB = [
            {
                id: 1, level: "L1", title: "Muddy Puddles (Peppa Pig)", 
                url: "https://www.w3schools.com/html/mov_bbb.mp4", icon: "piggy-bank",
                subs: [
                    { en: "It is raining today.", cn: "今天在下雨。" },
                    { en: "Peppa loves jumping in muddy puddles.", cn: "佩奇喜欢在泥坑里跳。" },
                    { en: "If you jump in muddy puddles, you must wear your boots.", cn: "如果你要在泥坑里跳，你必须穿上靴子。" }
                ]
            },
            {
                id: 2, level: "L2", title: "Frozen - Let It Go", 
                url: "https://www.w3schools.com/html/movie.mp4", icon: "snowflake",
                subs: [
                    { en: "The snow glows white on the mountain tonight.", cn: "今晚白雪在山上闪耀。" },
                    { en: "Not a footprint to be seen.", cn: "没有留下一个脚印。" },
                    { en: "A kingdom of isolation, and it looks like I'm the queen.", cn: "这片与世隔绝的国度，看起来我就是这里的女王。" }
                ]
            },
            {
                id: 3, level: "L5", title: "Daily Life Conversation", 
                url: "https://vjs.zencdn.net/v/oceans.mp4", icon: "coffee",
                subs: [
                    { en: "Would you like to grab a coffee this afternoon?", cn: "今天下午想去喝杯咖啡吗？" },
                    { en: "That sounds like a great plan.", cn: "听起来是个很棒的计划。" }
                ]
            },
            {
                id: 9, level: "L9", title: "Quantum Physics Introduction", 
                url: "https://www.w3schools.com/html/mov_bbb.mp4", icon: "atom",
                subs: [
                    { en: "Quantum entanglement is a complex physical phenomenon.", cn: "量子纠缠是一种复杂的物理现象。" },
                    { en: "It occurs when particles interact in ways such that the state of each cannot be described independently.", cn: "当粒子以某种方式相互作用，使得每个粒子的状态无法被独立描述时，就会发生这种现象。" }
                ]
            }
            // 你可以继续在此添加 L3, L4, L6 等对应等级的视频数据
        ];

        let favorites = JSON.parse(localStorage.getItem('my_favs')) || [];
        let notes = JSON.parse(localStorage.getItem('my_notes')) || [];

        // --- 初始化运行 ---
        document.addEventListener('DOMContentLoaded', () => {
            renderCourses('all');
            initTabNav();
            initLevelFilter();
            renderVocabulary();
            renderFavorites();
            renderNotes();
        });

        // --- 1. 课程与播放器核心逻辑 ---
        function renderCourses(filterLevel) {
            const list = document.getElementById('course-list');
            const data = filterLevel === 'all' ? videoDB : videoDB.filter(v => v.level === filterLevel);
            
            list.innerHTML = data.length ? data.map(v => `
                <div class="course-item" onclick="openPlayer(${v.id})">
                    <div class="course-icon"><i class="fas fa-${v.icon}"></i></div>
                    <div style="flex:1">
                        <div style="font-weight:bold">${v.title}</div>
                        <span class="course-difficulty">${v.level}</span>
                    </div>
                    <i class="fas fa-chevron-right" style="color:#ccc"></i>
                </div>
            `).join('') : '<p style="padding:20px; color:#999; text-align:center">该级别内容准备中...</p>';
        }

        function openPlayer(id) {
            const video = videoDB.find(v => v.id === id);
            document.getElementById('course-home').style.display = 'none';
            document.getElementById('player-section').style.display = 'block';
            document.getElementById('player-title').innerText = video.title;
            
            // 加载视频
            const vPlayer = document.getElementById('main-video');
            vPlayer.src = video.url;
            vPlayer.play();

            // 注入对应字幕
            const subBox = document.getElementById('transcript-box');
            subBox.innerHTML = video.subs.map((s, index) => `
                <div class="transcript-line ${index===0?'active':''}" data-en="${s.en}">
                    <div class="english">${s.en}</div>
                    <div class="translation">${s.cn}</div>
                </div>
            `).join('');

            // 字幕点击发音
            document.querySelectorAll('.transcript-line').forEach(el => {
                el.onclick = function() {
                    document.querySelectorAll('.transcript-line').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    speak(this.dataset.en);
                };
            });
        }

        function closePlayer() {
            document.getElementById('main-video').pause();
            document.getElementById('course-home').style.display = 'block';
            document.getElementById('player-section').style.display = 'none';
        }

        function initLevelFilter() {
            document.querySelectorAll('.level-item').forEach(item => {
                item.onclick = function() {
                    document.querySelectorAll('.level-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    renderCourses(this.dataset.level);
                }
            });
        }

        // --- 2. API: 语音发音 (TTS) ---
        function speak(text) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'en-US';
            msg.rate = document.getElementById('speed-sel').value;
            window.speechSynthesis.speak(msg);
        }

        // --- 3. API: 录音识别 (STT) ---
        function startRecording() {
            const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
            if(!SpeechRec) return alert("您的浏览器不支持语音识别");
            
            const recognition = new SpeechRec();
            recognition.lang = 'en-US';
            showToast("正在听你说话...");
            
            recognition.onresult = (e) => {
                const result = e.results[0][0].transcript;
                const score = Math.floor(Math.random() * 20) + 75;
                document.getElementById('score-val').innerText = score;
                document.getElementById('score-text').innerHTML = `你读的是：<br>"${result}"`;
                document.getElementById('overlay').classList.add('active');
                document.getElementById('score-modal').classList.add('active');
            };
            recognition.start();
        }

        // --- 4. 词汇与收藏持久化 ---
        const vocabData = [
            { w: "Curiosity", p: "[ˌkjʊəriˈɒsəti]", m: "n. 好奇心" },
            { w: "Evolution", p: "[ˌiːvəˈluːʃn]", m: "n. 进化" },
            { w: "Independent", p: "[ˌɪndɪˈpendənt]", m: "adj. 独立的" }
        ];

        function renderVocabulary() {
            const box = document.getElementById('word-list-box');
            box.innerHTML = vocabData.map(v => `
                <div class="course-item">
                    <div style="flex:1">
                        <div style="color:var(--primary-color); font-weight:bold">${v.w} ${v.p}</div>
                        <div style="font-size:0.9rem">${v.m}</div>
                    </div>
                    <button onclick="speak('${v.w}')" style="border:none; background:none; color:var(--primary-color); font-size:1.3rem; margin-right:15px"><i class="fas fa-volume-up"></i></button>
                    <button onclick="toggleFav('${v.w}')" style="border:none; background:none; color:${favorites.includes(v.w)?'var(--danger-color)':'#ccc'}; font-size:1.3rem"><i class="fas fa-heart"></i></button>
                </div>
            `).join('');
        }

        function toggleFav(w) {
            const idx = favorites.indexOf(w);
            if(idx > -1) favorites.splice(idx, 1);
            else favorites.push(w);
            localStorage.setItem('my_favs', JSON.stringify(favorites));
            renderVocabulary(); renderFavorites();
        }

        function renderFavorites() {
            const box = document.getElementById('fav-list-box');
            box.innerHTML = favorites.length ? favorites.map(f => `
                <div class="course-item">
                    <div style="flex:1; font-weight:bold">${f}</div>
                    <button onclick="toggleFav('${f}')" style="border:none; background:none; color:var(--danger-color)"><i class="fas fa-trash"></i></button>
                </div>
            `).join('') : '<p style="text-align:center; color:#999">空空如也</p>';
        }

        // --- 5. 笔记在线管理 ---
        function renderNotes() {
            const box = document.getElementById('notes-list-box');
            box.innerHTML = notes.map(n => `
                <div class="note-card">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:0.8rem; color:#888">
                        <span>${n.time}</span>
                        <button class="note-del-btn" onclick="delNote('${n.id}')"><i class="fas fa-trash"></i></button>
                    </div>
                    <div style="white-space:pre-wrap">${n.text}</div>
                </div>
            `).join('');
        }

        function addNote() {
            const text = prompt("输入学习笔记：");
            if(text) {
                notes.unshift({ id: Date.now().toString(), text: text, time: new Date().toLocaleString() });
                localStorage.setItem('my_notes', JSON.stringify(notes));
                renderNotes();
            }
        }

        function delNote(id) {
            if(confirm("确定删除吗？")) {
                notes = notes.filter(n => n.id !== id);
                localStorage.setItem('my_notes', JSON.stringify(notes));
                renderNotes();
            }
        }

        // --- 通用工具 ---
        function initTabNav() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.onclick = function() {
                    document.querySelectorAll('.nav-item, .content-section').forEach(el => el.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById(this.dataset.tab).classList.add('active');
                }
            });
        }

        function repeatLine() {
            const active = document.querySelector('.transcript-line.active');
            if(active) speak(active.dataset.en);
        }

        function toggleTrans() {
            const show = document.getElementById('trans-toggle').checked;
            document.querySelectorAll('.translation').forEach(t => t.style.display = show ? 'block' : 'none');
        }

        function changeSpeed() {
            document.getElementById('main-video').playbackRate = document.getElementById('speed-sel').value;
        }

        function closeScore() {
            document.getElementById('overlay').classList.remove('active');
            document.getElementById('score-modal').classList.remove('active');
        }

        function showToast(m) {
            const t = document.createElement('div');
            t.style = "position:fixed; top:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); color:white; padding:8px 16px; border-radius:20px; z-index:9999; font-size:14px";
            t.innerText = m; document.body.appendChild(t);
            setTimeout(() => t.remove(), 2000);
        }
    </script>
</body>
</html>
